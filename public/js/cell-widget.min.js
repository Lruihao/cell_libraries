Cell.Dialog=function(){function g(h={}){var c=g.prototype;this.option=h;this.option.backdrop=void 0===this.option.backdrop?!0:this.option.backdrop;this._domNode=this._modal=k(this.option.appendTo||".cell-main-container",this.option.className);f(this);m(this._modal,this.option.title||null);l(this);e(this._modal);b(this);c.find=function(a){return $(this._modal).find(a)};c.setTitle=function(a){this.find(".modal-title").html(a||this.option.title);return this};c.setContent=function(a){this.find(".modal-html").html(a||
this.option.content);return this};c.setContentClass=function(a){this.find(".modal-html").addClass(a||this.option.contentClass||"");return this};c.setEvents=function(a){if(!a)return this;Array.isArray(a)||(a=[a]);let c=this;$.each(a,function(a,b){var h=c._modal,e=b.selector;a=b.event;b=b.handler;h=e?$(h).find(e):h;$(h).off(a).on(a,b)});return this};c.setIcon=function(a,b){p(this,a,b);return this};c.render=function(b){this.setTitle(b.title).setIcon(b.iconClass,b.faicon||n(b.type||0)).setContent(b.content).setContentClass(b.contentClass).setEvents(b.events);
a(this,b);return this};c.show=function(a={}){this.render(a);$(this._modal).modal({show:!0,backdrop:void 0===a.backdrop?this.option.backdrop:a.backdrop});$(this._modal).modal("handleUpdate");return this};c.hide=function(){$(this._modal).modal("hide");return this};a(this,this.option);this.render(this.option)}var k=(a,b)=>{let c=document.createElement("div");$(c).appendTo(a).addClass("modal").addClass("cell-dialog").addClass(b).attr({tabindex:-1,role:"dialog","aria-hidden":!0});return c},f=a=>{let b=
document.createElement("div");$(b).appendTo(a._domNode).addClass("modal-dialog").addClass("modal-dialog-centered").attr("role","document");a._modalContent=$(document.createElement("div")).appendTo(b).addClass("modal-content")},m=(a,b)=>{if(b){var c=document.createElement("div");$(c).prependTo($(a).find(".modal-content")).addClass("modal-header");$(document.createElement("div")).appendTo(c).addClass("modal-title").html(b)}},l=a=>{let b;b=0<$(a.option.replaceTo).length?$(a.option.replaceTo).removeClass("d-none"):
document.createElement("div");$(b).appendTo($(a._domNode).find(".modal-content")).addClass("modal-body");$(document.createElement("div")).appendTo(b).addClass("modal-html")},e=a=>{let b=document.createElement("div");$(b).appendTo($(a).find(".modal-content")).addClass("modal-footer");return b},b=a=>{a.option.buttons&&(Array.isArray(a.option.buttons)||(a.option.buttons=[a.option.buttons]),$.each(a.option.buttons,(b,h)=>{c(a,h)}))},c=(a,b)=>{let c=$(document.createElement("button"));c.appendTo($(a._modalContent).find(".modal-footer")).addClass("btn").addClass(b.type||
"btn-light").addClass(b.className||"");!1!==b.dismiss&&c.attr("data-dismiss","modal");$.each(b.attrs,(a,b)=>{c.attr(a,b)});b.faicon&&$(document.createElement("i")).appendTo(c).addClass(b.faicon);$(document.createElement("span")).appendTo(c).html(b.label);if(b.onclick)c.on("click",b.onclick)},n=function(a){switch(a){case 1:case "warning":return"fas fa-exclamation-triangle";case 2:case "success":return"fas fa-check-circle";case 3:case "info":return"fas fa-info-circle";case 4:case "error":return"fas fa-times-circle";
default:return""}},p=function(a,b,c){let h=$(a._modalContent);h.find(".modal-icon").remove();$(document.createElement("i")).prependTo(h.find(".modal-body")).addClass("modal-icon").addClass(b||a.option.iconClass||null).addClass(c||a.option.faicon||null);return this},a=function(a,b){$(a._modal).off("shown.bs.modal").on("shown.bs.modal",function(c){(c=b.onshowbefore||a.option.onshowbefore)&&c.call(a);clearTimeout(a._showTimer);a._showTimer=setTimeout(function(){0!==$(a._modal).find("[autofocus]").focus().length||
$(a._modal).find(".btn-primary").focus();let c=b.onshow||a.option.onshow;c&&c.call(a)},100)}).off("hidden.bs.modal").on("hidden.bs.modal",function(){clearTimeout(a._closeTimer);a._closeTimer=setTimeout(function(){let c=b.onclose||a.option.onclose;c&&c.call(a)},100)});return this};return g}();
Cell.Tooltip=function(){function g(c={}){var n=g.prototype;this.option=c;this.option.closeable=void 0===this.option.closeable?!0:this.option.closeable;this._tooltip=k(this.option.appendTo);f(this._tooltip);this._closebtn=document.createElement("button");$(this._closebtn).appendTo($(this._tooltip)).addClass("close").html("&times;").attr({type:"button","aria-label":"Close"});m(this);n.find=function(b){return $(this._tooltip).find(b)};n.setClassName=function(b){$(this._tooltip).removeClass().addClass("cell-tooltip alert alert-dismissible").addClass(b||
this.option.className||"alert-light");return this};n.setContent=function(b){this.find(".tooltip-content").html(b||this.option.content);return this};n.setContentClass=function(b){this.find(".tooltip-content").removeClass().addClass("tooltip-content").addClass(b||this.option.contentClass||"");return this};n.setIcon=function(b,a){e(this,b,a);return this};n.show=function(c={}){c.closeable=void 0===c.closeable?this.option.closeable:c.closeable;this.setIcon(c.iconClass,c.faicon||l(c.type||0)).setContent(c.content).setContentClass(c.contentClass).setClassName(c.className);
b(this,c.delay||this.option.delay||3E3);c=c.closeable;$(this._tooltip).toggleClass("alert-dismissible",c);c?$(this._closebtn).show():$(this._closebtn).hide();$(this._tooltip).fadeIn();return this};n.hide=()=>{$(this._tooltip).fadeOut();clearTimeout(this.timeout);return this}}var k=function(b="body"){return $(document.createElement("div")).appendTo(b).addClass("cell-tooltip alert alert-dismissible").attr({tabindex:"-1",role:"alert","aria-hidden":!0}).css("display","none")},f=function(b){$(document.createElement("div")).appendTo($(b)).addClass("tooltip-content")},
m=function(b){$(b._closebtn).on("click",function(){b.hide()});return this},l=function(b){switch(b){case 1:case "warning":return"fas fa-exclamation-triangle";case 2:case "success":return"fas fa-check-circle";case 3:case "info":return"fas fa-info-circle";case 4:case "error":return"fas fa-times";default:return""}},e=function(b,e,f){let a=$(b._tooltip);a.find(".tooltip-icon").remove();$(document.createElement("i")).prependTo(a).addClass("tooltip-icon").addClass(e||b.option.iconClass||null).addClass(f||
b.option.faicon||null);return this},b=function(b,e){b.timeout&&clearTimeout(b.timeout);b.timeout=setTimeout(()=>{b.hide()},e);return this};return g}();
Cell.Message=function(){function g(){var k=g.prototype;this._dialog=new Cell.Dialog({appendTo:document.body,className:"cell-message",buttons:{label:"OK",faicon:"fas fa-check",type:"btn-primary",attrs:{autofocus:!0}}});k.setLabel=function(f){$(this._dialog._modalContent).find(".btn-primary").find("span").html(f||this.option&&this.option.label||"OK");return this};k.show=function(f){this.setLabel(f.label);f.content=f.content||"";f.onclose=f.ok;f.backdrop=void 0===f.backdrop?"static":f.backdrop;!0===
f.noButton?this._dialog.find(".btn-primary").hide():this._dialog.find(".btn-primary").show().focus();this._dialog.show(f);return this};k.hide=()=>{this._dialog.hide()}}return g}();
Cell.Confirm=function(){function g(k={}){var f=g.prototype;this._dialog=new Cell.Dialog({appendTo:k.replaceTo?null:k.appendTo||document.body,replaceTo:k.replaceTo,className:"cell-confirm",buttons:[{className:"cancel",attrs:{autofocus:!0}},{className:"ok"}]});f.setButton=function(f,g){let e=this,b=$(this._dialog._modalContent).find(`.${f}`);b.removeAttr("class").addClass("btn").addClass(f).addClass(g.type).find("span").html(g.label||"");b.find(".svg-inline--fa").remove();$(document.createElement("i")).prependTo(b).addClass("fas").addClass(g.faicon);
!0===g.autoFocus?$(b).attr("autofocus",!0):$(b).removeAttr("autofocus");if(g.click)$(b).unbind("click").on("click",function(){setTimeout(g.click.call(e),300)});return this};f.show=function(f){this.setButton("ok",$().extend({label:"OK",faicon:"fa-check",type:"btn-primary"},f.ok));this.setButton("cancel",$().extend({label:"Cancel",faicon:"fa-times",type:"btn-light"},f.cancel));f.content=f.content||"";f.backdrop=void 0===f.backdrop?"static":f.backdrop;this._dialog.show(f);return this}}return g}();
Cell.Tab=function(){function g(b){var c=g.prototype;this.options=b||{};k(this);f(this);$(document.createElement("hr")).appendTo(this._domNode).addClass("cell-tab-menu-underline");e(this);l(this);c.show=function(b){$c.replaceHistory(location.pathname+location.search+`#${b}`);l(this);return this}}var k=b=>{let c;b.options.replaceTo?c=$(b.options.replaceTo):(c=document.createElement("div"),$(c).appendTo(b.options.appendTo||".cell-main-container"));$(c).addClass("cell-tab-menu");b._domNode=c},f=b=>{b._tabSetting=
[];b.options.tabs.forEach(function(c,e){m(b,c);b._tabSetting[c.target]=c})},m=(b,c)=>{let e="#"+(c.target||"");$(document.createElement("a")).appendTo(b._domNode).addClass("cell-tab-menu-item").addClass(c.faicon||"").addClass(c.className||"").html(c.label).attr("href",e).on("click",function(c){c.preventDefault();$c.replaceHistory(location.pathname+location.search+e);l(b)})},l=b=>{$(".cell-tab.show").removeClass("show");var c=location.hash.toString().replace("#","");let e;if(""===c)e=b.options.defaultTab;
else{for(var f in b._tabSetting)if(c===f||$(document.getElementById(f)).find(document.getElementById(c)).length){e=f;break}e=e||c}f=$(b._domNode).find(`[href="#${e}"]`);if(0!==f.length){var a=b._tabSetting[e]||{};$(b._domNode).find(".cell-tab-menu-underline").width($(f).outerWidth()).css("left",$(f).position().left);$(b._domNode).find(".cell-tab-menu-item.selected").removeClass("selected");$(document.getElementById(e)).addClass("show");$(f).addClass("selected");if(c&&c!==e){var h=document.getElementById(e);
let a=$(document.getElementById(c));c=$(h).scrollParent().find(".position-sticky:visible, .sticky-top:visible, .position-fixed:visible").filter(function(a,b){return"auto"!==$(b).css("top")});h=a.offset().top-$(h).offset().top;c.length&&(h-=parseInt(c.css("top"))+c.outerHeight());0<h&&$(window).scrollTop(h)}"true"!==$(f).attr("data-initialized")&&($(f).attr("data-initialized",!0),a.init&&a.init.call(b),!1!==b.options.autoSticky&&$c.stackSticky("top",`#${e}`));a.onshow&&a.onshow.call(this);$(document.getElementById(e)).find("[autofocus]").focus()}};
let e=b=>{$(window).off("hashchange").on("hashchange",function(c){l(b)})};return g}();
Cell.Searchbar=function(){function g(d){var b=g.prototype;this.options=d||{};this.options.valueName=this.options.valueName||"value";this.options.labelName=this.options.labelName||"label";this.options.varName=this.options.varName||"q";this._lastDisplayValue="";this._domNode=k(this);f(this);m(this);c(this);this._xhr=null;b.getValue=function(){return $(this._domNode).find(".cell-searchbar-input").val()};b.getDisplayValue=function(){return $(this._domNode).find(".cell-searchbar-display-input").val()};
b.setValue=function(d){l(this,d);return this};b.search=function(d=!0){a(this,!0,d);return this};b.selectPropose=function(d,a=!0){$(d).addClass("hover");d=$(this._domNode);!0===a?d.find(".cell-searchbar-display-input").trigger($.Event("keyup",{keyCode:13})):d.trigger("focusout");return this};b.addPropose=function(d){let a=this,b=document.createElement("li"),c=$(b);c.appendTo($(this._domNode).find(".cell-searchbar-propose")).attr("data-label",d[a.options.labelName]).attr("data-value",d[a.options.valueName]).attr("data-keyword",
d.keyword||null).data(d).on("click",function(){a.selectPropose(this)});this.options.formatter?this.options.formatter.call(this,b,d):c.html(d[a.options.labelName]);d=c.children();0===d.length?v(a,c):$.each(d,(d,b)=>{v(a,b)});return this};b.resetPropose=function(){$(this._domNode).find(".cell-searchbar-propose").empty();$(this._domNode).find(".cell-searchbar-loader").show();$(this._domNode).find(".cell-searchbar-empty-message").hide();$(this._domNode).find(".cell-searchbar-notfind-message").hide();
return this};b.renderPropose=function(){let d=$(this._domNode),a=$(this._domNode).find(".cell-searchbar-result");d.scrollParent().height()-d.position().top-d.outerHeight()-100<a.height()?a.css({bottom:$(this._domNode).find(".cell-searchbar-form").outerHeight(),top:""}):a.css({bottom:"",top:$(this._domNode).find(".cell-searchbar-form").outerHeight()});return this};b.reset=function(d){this.resetPropose();e(this,null,null,!0);!0===d&&r(this);$(this._domNode).find(".cell-searchbar-display-input").focus();
return this};b.complete=function(){r(this);return this};b.setSearchUrl=function(d){this.options.searchUrl=d;return this};b.setSearchData=function(d){this.options.searchData?$.extend(this.options.searchData,d):this.options.searchData=d;return this};b.setRequired=function(d){this.options.required=d;!0===this.options.required?$(this._domNode).find(".cell-searchbar-display-input").attr("required",!0):$(this._domNode).find(".cell-searchbar-display-input").removeAttr("required");q(this,!0);return this};
b.blur=function(){$(this._domNode).blur();return this};b.focus=function(){$(this._domNode).find(".cell-searchbar-display-input").focus();return this};if(this.options.displayValue||this.options.value)e(this,this.options.displayValue,this.options.value,!1),this._lastDisplayValue=this.options.displayValue}var k=d=>{let a;d.options.replaceTo?a=$(d.options.replaceTo).attr("class",""):(a=$(document.createElement("div")),a.appendTo(d.options.appendTo||".cell-main-container"));a.attr("tabindex","-1").addClass("cell-searchbar");
return a[0]},f=d=>{let a=document.createElement("div");$(a).appendTo(d._domNode).addClass("cell-searchbar-form").attr("tabindex","-1");!1!==d.options.faicon&&$(document.createElement("i")).appendTo(a).addClass("fas "+(d.options.faicon||"fa-search"));var b=document.createElement("input");$(b).appendTo(a).addClass("cell-searchbar-display-input").attr("type","text").attr("placeholder",d.options.placeholder||"Search").attr("autofocus",d.options.autofocus||!1).attr("autocomplete","off").attr("name",d.options.displayName||
null);!0===d.options.required&&$(b).attr("required",d.options.required||null);$(document.createElement("input")).appendTo(a).addClass("cell-searchbar-input").attr("type","hidden").attr("name",d.options.name);d=$(document.createElement("span"));d.appendTo(a).addClass("cell-searchbar-btn-empty").attr("tabindex","-1");$(document.createElement("i")).appendTo(d).addClass("fas fa-times")},m=d=>{if("string"===typeof d.options.searchUrl){var a=document.createElement("div");$(a).appendTo(d._domNode).addClass("cell-searchbar-result").css("top",
$(d._domNode).find(".cell-searchbar-form").outerHeight());$(document.createElement("ul")).appendTo(a).addClass("cell-searchbar-propose");var b=document.createElement("div");$(b).appendTo(a).addClass("cell-searchbar-loader");$(document.createElement("span")).appendTo(b).addClass("fad fa-spinner-third fa-spin m-r-1");$(document.createElement("span")).appendTo(b).html(d.options.loadingMessage||"Loding");$(document.createElement("div")).appendTo(a).addClass("cell-searchbar-empty-message").html(d.options.emptyMessage||
"No any propose");$(document.createElement("div")).appendTo(a).addClass("cell-searchbar-notfind-message").html(d.options.notfindMessage||"Not find relative propose")}},l=(d,a)=>{d.resetPropose();let b=a[d.options.labelName],c=a[d.options.valueName];d.addPropose(a);e(d,b,c,!0);return this},e=(d,a,c,e=!1,h)=>{$(d._domNode).find(".cell-searchbar-display-input").val(a||c||"");a=$(d._domNode).find(".cell-searchbar-input").val(c);!0===e&&a.trigger("change",h);b(d);return this},b=a=>{let d=$(a._domNode).find(".cell-searchbar-btn-empty");
0<a.getDisplayValue().length?d.css("display","inline-flex"):d.css("display","none");return t(a)},c=d=>{let c=$(d._domNode);c.on("focusout",function(a){c.removeClass("focused");a.relatedTarget!==this&&a.target!==c.find(".cell-searchbar-form")[0]&&(y(d,!0)||x(d,!0)||!d.options.matchPropose&&e(d,d.getDisplayValue(),d.getDisplayValue(),!0),d.options.onblur&&d.options.onblur.call(d,d.getDisplayValue(),d.getValue()),!0===d.options.completeClean&&e(d,null,null))}).on("focusin",function(){c.addClass("focused");
!0===d.options.focusClean&&e(d,null,null)}).find(".cell-searchbar-display-input").off("focus").on("focus",function(b){b.stopPropagation();b.preventDefault();c.removeClass("using");$(this).select();d.options.onfocus&&!1===d.options.onfocus.call(d,b,d.getDisplayValue(),d.getValue())||!0===d.options.autoSearch&&a(d,!0)}).on("input",function(){c.find(".cell-searchbar-input").val("");b(d);a(d)}).on("keydown",function(a){38===a.keyCode&&u(d,-1);40===a.keyCode&&u(d,1)}).on("keyup",function(a){if(13===a.keyCode)return d.blur();
if(27===a.keyCode)return d.reset()}).on("valid",function(){q(d,!0)}).on("invalid",function(){q(d,!1)});c.find(".cell-searchbar-input").on("change",function(a,b){r(d,b);d.options.onchange&&d.options.onchange.call(d,d.getDisplayValue(),d.getValue(),b)});c.find(".cell-searchbar-form").on("focus",function(){$(d._domNode).find(".cell-searchbar-display-input").focus().focus()});c.find(".cell-searchbar-btn-empty").on("focus, focusin",function(a){a.stopPropagation()}).on("click",function(){d.reset(!0)})},
n=a=>{a.options.pattern&&($(a.options.pattern).each(function(d,b){d=b+":";var c=new RegExp(d+"[\\S]+","i");(c=a.getValue().match(c))?(a.options.data[a.options.varName]=a.options.data[a.options.varName].replace(" "+c,"").trim(),a.options.data[b]=c.toString().replace(d,"").trim()):a.options.data[b]=void 0}),a.options.data[a.options.varName]=a.options.data[a.options.varName].trim().replace(" ","|"))},p=a=>{a.options.data=a.options.data||{};a.options.data[a.options.varName]=a.getDisplayValue();a.options.data[a.options.valueName]=
a.getValue();n(a)},a=(a,b=!1,c=!1)=>{!a.options.searchUrl||!0!==b&&a._lastDisplayValue===a.getDisplayValue()||(a._lastDisplayValue=a.getDisplayValue(),p(a),a._xhr&&a._xhr.abort(),a.options.oninput&&!1===a.options.oninput.call(a,a.options.data)||(b=$.extend(a.options.searchData,a.options.data),""===b[a.options.varName]&&delete b[a.options.varName],""===b[a.options.valueName]&&delete b[a.options.valueName],a.resetPropose(),a._xhr=$c.ajax.get({url:a.options.searchUrl,data:b,success:function(b){$(b).each(function(b,
d){a.addPropose(d)});w(a);a.renderPropose();!0===c&&h(a)},error:function(a){}})))},h=a=>{let b=$(a._domNode).find(".cell-searchbar-propose li:first-child");1===b.length&&a.selectPropose(b,!1)},w=a=>{let b=$(a._domNode).find(".cell-searchbar-notfind-message"),d=$(a._domNode).find(".cell-searchbar-empty-message");$(a._domNode).find(".cell-searchbar-loader").hide();0!==$(a._domNode).find(".cell-searchbar-propose li").length?(d.hide(),b.hide()):0===a.getDisplayValue().length?(d.show(),b.hide()):(d.hide(),
b.show())},t=a=>{if(!a.options.searchUrl||!1===a.options.matchPropose)return!0;let b=a.getDisplayValue().replace('"','\\"');if(0<a._domNode.querySelectorAll(`li[${"data-label"}="${b}" i], li[${"data-keyword"}="${b}" i]`).length&&0<b.length||!0!==a.options.required&&0===b.length)return q(a,!0),!0;q(a,!1);return!1},x=(a,b=!1)=>{if(!a.options.searchUrl||!1===a.options.matchPropose||0===a.getDisplayValue().length)return!1;var d=a.getDisplayValue().replace('"','\\"'),c=a._domNode.querySelectorAll(`li[${"data-label"}*="${d}" i], li[${"data-keyword"}*="${d}" i]`);
d=a._domNode.querySelectorAll(`li[${"data-label"}="${d}" i], li[${"data-keyword"}="${d}" i]`);if(1!==d.length&&1!==c.length)return!1;c=$(1===d.length?d:c);e(a,c.attr("data-label"),c.attr("data-value"),b);return!0},y=(a,b=!1)=>{let d=$(a._domNode).find(".cell-searchbar-propose").find("li.hover");if(0===d.length)return!1;e(a,d.attr("data-label"),d.attr("data-value"),b,d.data());return!0},u=(a,b)=>{a=$(a._domNode).find(".cell-searchbar-propose");let d=a.find("li.hover").removeClass("hover"),c=0<b?a.find("li:first-child"):
a.find("li:last-child");b=0===d.length?c:0<b?d.next():d.prev();0===b.length&&(b=c);b.addClass("hover");a=a.scrollParent();0>b.position().top&&a.scrollTop(a.scrollTop()+b.position().top);b.position().top+b.height()+10>a.height()&&a.scrollTop(a.scrollTop()+b.position().top+b.height()+10-a.height())},v=(a,b)=>{b=$(b);if(a=a.getDisplayValue())a=new RegExp(`(${$c.pregQuote(a)})`,"gi"),b.html(b.html().replace(a,'<span class="highlight">$1</span>'))},r=(a,b)=>{t(a)&&a.options.oncomplete&&(a.options.searchUrl||
a._lastDisplayValue!==a.getDisplayValue())&&(a._lastDisplayValue=a.getDisplayValue(),p(a),a.options.oncomplete.call(a,a.options.data,b),!0===a.options.completeClean&&e(a,null,null),!0===a.options.changeUrl&&(a=$c.setUrlParam(window.location.pathname+window.location.search,a.options.varName,encodeURIComponent(a.options.data[a.options.varName])||null),$c.pushHistory(a+window.location.hash)))},q=(a,b)=>{let c=$(a._domNode).find(".cell-searchbar-form"),d=$(a._domNode).find(".cell-searchbar-display-input")[0];
!0===b?(c.removeClass("invalid").addClass("valid"),d.setCustomValidity("")):(c.removeClass("valid").addClass("invalid"),d.setCustomValidity("error"));return a};return g}();
Cell.Filter=function(){function g(b){var c=g.prototype;this.options=b||{};this.options.name=this.options.name||"f";this.options.default=this.options.default||null;this._filter=k(this.options.appendTo,this.options.replaceTo);this._label=$(this._filter).find(".cell-filter-label");this._value=$(this._filter).find(".cell-filter-value");this.value=null;c.getItemLabel=function(b){return"null"===b||null===b?$(this._filter).find(`.cell-filter-item.${this.options.name.toString().replace(/_/g,"-")}`).html():
$(this._filter).find(`[value="${b}"]`).html()};c.selectItem=function(b){var c=$(b).attr("value");this.value!==c&&(this.value=c,$(this._value).html($(b).html()),!0===this.options.changeUrl&&(c=$c.setUrlParam(window.location.pathname+window.location.search,this.options.name,c||null),$c.pushHistory(c+window.location.hash)),this.options.onchange.call(this,b,this.value));$(this._filter).blur();return this};f(this)}var k=(b=".cell-main-container",c)=>{c?c=$(c).attr("class",""):(c=document.createElement("div"),
$(c).appendTo(b));$(c).attr("tabindex","1").addClass("cell-filter");b=document.createElement("div");$(b).appendTo(c).addClass("cell-filter-btn");$(document.createElement("span")).appendTo(b).addClass("cell-filter-label");$(document.createElement("span")).appendTo(b).addClass("cell-filter-value");return c},f=b=>{if(!b.options.url&&b.options.option)return m(b),b;$c.ajax.get({url:b.options.url,success:function(c){b.options.option=c;m(b)}});return b},m=b=>{l(b);$(b._label).html(b.options.label);$(b._value).html(b.getItemLabel(b.options.default));
if(!0===b.options.changeUrl&&b.options.default){let c=$c.setUrlParam(window.location.pathname+window.location.search,b.options.name,b.options.default)+window.location.hash;window.history.replaceState({url:c},null,c)}return b},l=b=>{let c=document.createElement("div");$(c).appendTo(b._filter).addClass("cell-filter-option");$.each(b.options.option,function(e,f){var a=b.options.name;a=a.toString().replace(/_/g,"-");$(document.createElement("div")).appendTo(c).addClass("cell-filter-item").addClass("null"!==
e?`${a}-${e}`:a).html(String(f).toString().trim()).attr("value","null"!==e?e:"")});e(b);return b},e=b=>{$(b._filter).find(".cell-filter-item").on("click",function(){b.selectItem(this)});return b};return g}();
Cell.Uploader=function(){function g(a){var b=g.prototype;this.options=a||{};this._dragCounter=0;this.options.name=this.options.name||"files";k(this);e(this);b.reload=function(){this.options.multiple?this.list.reload():this.list.reset()}}var k=a=>{a.options.replaceTo?a._domNode=$(a.options.replaceTo):(a._domNode=document.createElement("div"),$(a._domNode).appendTo(a.options.appendTo||document.querySelector(".cell-main-container")||document.body));$(a._domNode).addClass("cell-uploader").addClass(a.options.className||
"");a.options.dragPanel=a.options.dragPanel||a._domNode;a._idx=$(".cell-uploader").length;Array.isArray(a.options.accept)&&(a.options.accept=`.${a.options.accept.join(",.")}`);var e=document.createElement("input");$(e).appendTo(a._domNode).addClass("cell-uploader-input").attr("id","cell-uploader-input"+a._idx).attr("type","file").attr("accept",a.options.accept||null).on("change",function(b){a._droppedFiles=b.target.files;c(a)});!0===a.options.multiple&&$(e).attr("multiple",!0);b(a);e=document.createElement("label");
$(e).appendTo(a._domNode).attr("for","cell-uploader-input"+a._idx).addClass("cell-uploader-label");$(document.createElement("strong")).appendTo(e).addClass("cell-uploader-strong").html(a.options.label||"Choose a file");$(document.createElement("span")).appendTo(e).addClass("cell-uploader-span").html(a.options.dragLabel||"or drop file to here.");$(document.createElement("span")).appendTo(e).addClass("cell-uploader-filetype").addClass("brackets");f(a);m(a);l(a)},f=a=>{$(a.options.dragPanel).addClass("cell-uploader-drag-panel");
$(document.createElement("div")).appendTo(a.options.dragPanel).addClass("cell-uploader-dragover-message").html(a.options.dragMessage||"Drop files here to upload.")},m=a=>{if(!0!==a.options.disableRemove){var b=document.createElement("div");$(b).appendTo(a._domNode).addClass("cell-grid-toolbar");var c=document.createElement("div");$(c).appendTo(b).addClass("float-right");b=document.createElement("span");$(b).appendTo(c).addClass("cell-btn-circle btn-remove-file d-none").attr("data-toggle","tooltip").attr("title",
"Delete file").on("click",function(){p(a)}).tooltip();$(document.createElement("i")).appendTo(b).addClass("fa fa-trash-alt")}},l=a=>{a.list=new Cell.Grid({appendTo:a._domNode,url:a.options.url,query:a.options.query,headerSticky:!1,identify:"displayId",selector:!a.options.disableRemove,fields:[{name:"displayId",hidden:!0},{name:"id",hidden:!0},{name:"size",hidden:!0},{name:"name",label:"File",formatter:function(b,c,e){if(!0!==a.options.displaySize)return e;let f=document.createElement("div");$(f).appendTo(c);
$(document.createElement("span")).appendTo(f).html(e);$(document.createElement("span")).appendTo(f).addClass("size").html($c.file.formatBytes(this.getItemData(b,"size")))}},{name:"message",label:"Status",formatter:function(b,c,e){e&&(b=this.getItemData(b,"id"),$(c).html(e.message||n(e.code)),$(c).removeClass("uploading"),-1<Number(e.code)&&$(c).addClass("status-"+e.code),0===e.code&&b&&$(document.createElement("input")).appendTo(c).attr("type","hidden").attr("name",a.options.name+"[]").val(b))}}],
emptyMessage:a.options.emptyMessage||"No files.",onselected:function(b){$(a._domNode).find(".cell-grid-toolbar .cell-btn-circle").toggleClass("d-none",!b.length)},onload:function(){!a.options.multiple&&1<this.getItemCount()&&this.removeItems(this.getItemId(this.getFirstItem()))}})},e=a=>{$(a.options.dragPanel).on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault();a.stopPropagation()}).on("dragenter",function(){$(this).addClass("cell-uploader-dragover");a._dragCounter++}).on("dragleave",
function(){a._dragCounter--;0===a._dragCounter&&$(this).removeClass("cell-uploader-dragover")}).on("drop",function(b){!0===a.options.clearOnDrag&&a.reload();a._dragCounter=0;$(this).removeClass("cell-uploader-dragover");a._droppedFiles=b.originalEvent.dataTransfer.files;c(a)})},b=a=>{$c.ajax.get({url:a.options.fileTypeUrl||$c.router("//file_manager/extensions"),success:function(b){$("#cell-uploader-input"+a._idx).attr("accept",a.options.accept?`${a.options.accept},${b.types}`:b.types);a.options.fileType=
b.exts;Array.isArray(a.options.fileType)&&$(a._domNode).find(".cell-uploader-filetype").html(a.options.fileType.join(", "))}})},c=a=>{let b=new FormData(a.options.data);if(a._droppedFiles){!0!==a.options.multiple&&(a.reload(),a._droppedFiles=[a._droppedFiles[0]]);var c=[];$.each(a._droppedFiles,(e,f)=>{e=a.list.addItem({id:null,name:f.name,size:f.size},!0);c.push(e);b.append("display_ids[]",e);b.append("files[]",f)});$c.ajax.post({url:a.options.uploadUrl,data:b,cache:!1,contentType:!1,processData:!1,
xhr:function(){$(a._domNode).find(".cell-uploader-input").val(null);let b=$.ajaxSettings.xhr();b.upload&&b.upload.addEventListener("progress",function(b){b.lengthComputable&&(b=(100*b.loaded/b.total).toFixed(2),a.list.setItemColVal(c,"message",{code:-1,message:"\u4e0a\u50b3\u4e2d ("+b+"%)"}))},!1);return b},success:function(b){$.each(b,function(b,c){a.list.setItemColVal(b,"id",c.id||null);a.list.setItemColVal(b,"message",{code:c.err_code,message:c.message})});0===b.length&&$.each(c,function(b,c){a.list.setItemColVal(c,
"message",{code:99,message:"\u4e0d\u660e\u7684\u932f\u8aa4\uff0c\u8acb\u6aa2\u67e5\u4f3a\u670d\u5668\u8a2d\u5b9a"})});a.options.onuploaded&&a.options.onuploaded.call(a,b)}})}},n=a=>{switch(a){case 0:return"\u4e0a\u50b3\u5b8c\u6210";case 1:return"\u4e0a\u50b3\u5931\u6557\uff1a\u6a94\u6848\u5927\u5c0f\u8d85\u51fa\u9650\u5236 "+a;case 2:return"\u4e0a\u50b3\u5931\u6557\uff1a\u6a94\u6848\u5927\u5c0f\u8d85\u51fa\u9650\u5236 "+a;case 8:return"\u4e0a\u50b3\u5931\u6557\uff1a\u4e0d\u5141\u8a31\u7684\u6a94\u6848\u985e\u578b";
case 9:return"\u4e0a\u50b3\u5931\u6557\uff1a"+a;default:return"\u4e0a\u50b3\u5931\u6557\uff1a"+a}},p=a=>{let b=a.list.getSelectionVal("displayId"),c=a.list.getSelectionVal("id");if(0===c.length)return a.list.removeItems(b),this;$c.ajax.delete({url:a.options.removeUrl,data:{ids:c},success:function(c){a.list.removeItems(b);a.options.onremoved&&a.options.onremoved.call(a,c)}});return this};return g}();
Cell.SingleUploader=function(){function g(e){var b=g.prototype;this.options=e||{};this.options.name=this.options.name||"files";k(this);b.setInfo=function(b){$(this._domNode).find(".cell-single-uploader-info").html(b)}}var k=e=>{e.options.replaceTo?e._domNode=$(e.options.replaceTo):(e._domNode=document.createElement("div"),$(e._domNode).appendTo(e.options.appendTo||document.querySelector(".cell-main-container")||document.body));var b=document.createElement("input");Array.isArray(e.options.accept)&&
(e.options.accept=`.${e.options.accept.join(",.")}`);$(b).appendTo(e._domNode).addClass("cell-single-uploader-input").addClass("form-control-file").attr("type","file").attr("accept",e.options.accept||null).on("change",function(b){e._droppedFiles=b.target.files;m(e)});f(e);b=$(document.createElement("div")).appendTo(e._domNode);$(document.createElement("span")).appendTo(b).addClass("cell-single-uploader-info text-info");$(document.createElement("small")).appendTo(b).addClass("cell-single-uploader-label").html(e.options.label);
$(document.createElement("small")).appendTo(b).addClass("text-muted cell-uploader-filetype").addClass("brackets")},f=e=>{$c.ajax.get({url:e.options.fileTypeUrl||$c.router("//file_manager/extensions"),success:function(b){$(e._domNode).find("input").attr("accept",e.options.accept?`${e.options.accept},${b.types}`:b.types);e.options.fileType=b.exts;Array.isArray(e.options.fileType)&&$(e._domNode).find(".cell-uploader-filetype").html(e.options.fileType.join(", "))}})},m=e=>{let b=new FormData(e.options.data);
e._droppedFiles&&(b.append("file",e._droppedFiles[0]),$c.ajax.post({url:e.options.uploadUrl,data:b,cache:!1,contentType:!1,processData:!1,xhr:function(){$(e._domNode).find(".cell-single-uploader-input").val(null);let b=$.ajaxSettings.xhr();b.upload&&b.upload.addEventListener("progress",function(b){b.lengthComputable&&(b=(100*b.loaded/b.total).toFixed(2),$(e._domNode).find(".cell-single-uploader-info").html("Uploading..."+b+"%"))},!1);return b},success:function(b){b||e.setInfo("\u4e0d\u660e\u7684\u932f\u8aa4\uff0c\u8acb\u6aa2\u67e5\u4f3a\u670d\u5668\u8a2d\u5b9a");
0===b.code?(e.setInfo("Success!"),e.options.onuploaded&&e.options.onuploaded.call(e,b)):e.setInfo(l(b.code))}}))},l=e=>{switch(e){case 0:return"\u4e0a\u50b3\u5b8c\u6210";case 1:return"\u4e0a\u50b3\u5931\u6557\uff1a\u6a94\u6848\u5927\u5c0f\u8d85\u51fa\u9650\u5236 "+e;case 2:return"\u4e0a\u50b3\u5931\u6557\uff1a\u6a94\u6848\u5927\u5c0f\u8d85\u51fa\u9650\u5236 "+e;case 8:return"\u4e0a\u50b3\u5931\u6557\uff1a\u4e0d\u5141\u8a31\u7684\u6a94\u6848\u985e\u578b";case 9:return"\u4e0a\u50b3\u5931\u6557\uff1a"+
e;default:return"\u4e0a\u50b3\u5931\u6557\uff1a"+e}};return g}();$().ready(()=>{$c.confirm=new Cell.Confirm;$c.message=new Cell.Message;$c.tooltip=new Cell.Tooltip});