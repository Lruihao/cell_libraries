Cell.Dialog=function(){function g(h={}){var c=g.prototype;this.option=h;this.option.backdrop=void 0===this.option.backdrop?!0:this.option.backdrop;this._domNode=this._modal=k(this.option.appendTo||".cell-main-container",this.option.className);f(this);m(this._modal,this.option.title||null);l(this);e(this._modal);a(this);c.find=function(b){return $(this._modal).find(b)};c.setTitle=function(b){this.find(".modal-title").html(b||this.option.title);return this};c.setContent=function(b){this.find(".modal-html").html(b||
this.option.content);return this};c.setContentClass=function(b){this.find(".modal-html").addClass(b||this.option.contentClass||"");return this};c.setEvents=function(b){if(!b)return this;Array.isArray(b)||(b=[b]);let c=this;$.each(b,function(b,a){var h=c._modal,e=a.selector;b=a.event;a=a.handler;h=e?$(h).find(e):h;$(h).off(b).on(b,a)});return this};c.setIcon=function(b,a){p(this,b,a);return this};c.render=function(a){this.setTitle(a.title).setIcon(a.iconClass,a.faicon||n(a.type||0)).setContent(a.content).setContentClass(a.contentClass).setEvents(a.events);
b(this,a);return this};c.show=function(b={}){this.render(b);$(this._modal).modal({show:!0,backdrop:void 0===b.backdrop?this.option.backdrop:b.backdrop});$(this._modal).modal("handleUpdate");return this};c.hide=function(){$(this._modal).modal("hide");return this};b(this,this.option);this.render(this.option)}var k=(b,a)=>{let c=document.createElement("div");$(c).appendTo(b).addClass("modal").addClass("cell-dialog").addClass(a).attr({tabindex:-1,role:"dialog","aria-hidden":!0});return c},f=b=>{let a=
document.createElement("div");$(a).appendTo(b._domNode).addClass("modal-dialog").addClass("modal-dialog-centered").attr("role","document");b._modalContent=$(document.createElement("div")).appendTo(a).addClass("modal-content")},m=(b,a)=>{if(a){var c=document.createElement("div");$(c).prependTo($(b).find(".modal-content")).addClass("modal-header");$(document.createElement("div")).appendTo(c).addClass("modal-title").html(a)}},l=b=>{let a;a=0<$(b.option.replaceTo).length?$(b.option.replaceTo).removeClass("d-none"):
document.createElement("div");$(a).appendTo($(b._domNode).find(".modal-content")).addClass("modal-body");$(document.createElement("div")).appendTo(a).addClass("modal-html")},e=b=>{let a=document.createElement("div");$(a).appendTo($(b).find(".modal-content")).addClass("modal-footer");return a},a=b=>{b.option.buttons&&(Array.isArray(b.option.buttons)||(b.option.buttons=[b.option.buttons]),$.each(b.option.buttons,(a,h)=>{c(b,h)}))},c=(b,a)=>{let c=$(document.createElement("button"));c.appendTo($(b._modalContent).find(".modal-footer")).addClass("btn").addClass(a.type||
"btn-light").addClass(a.className||"");!1!==a.dismiss&&c.attr("data-dismiss","modal");$.each(a.attrs,(b,a)=>{c.attr(b,a)});a.faicon&&$(document.createElement("i")).appendTo(c).addClass(a.faicon);$(document.createElement("span")).appendTo(c).html(a.label);if(a.onclick)c.on("click",a.onclick)},n=function(b){switch(b){case 1:case "warning":return"fas fa-exclamation-triangle";case 2:case "success":return"fas fa-check-circle";case 3:case "info":return"fas fa-info-circle";case 4:case "error":return"fas fa-times-circle";
default:return""}},p=function(b,a,c){let h=$(b._modalContent);h.find(".modal-icon").remove();$(document.createElement("i")).prependTo(h.find(".modal-body")).addClass("modal-icon").addClass(a||b.option.iconClass||null).addClass(c||b.option.faicon||null);return this},b=function(b,a){$(b._modal).off("shown.bs.modal").on("shown.bs.modal",function(c){(c=a.onshowbefore||b.option.onshowbefore)&&c.call(b);clearTimeout(b._showTimer);b._showTimer=setTimeout(function(){0!==$(b._modal).find("[autofocus]").focus().length||
$(b._modal).find(".btn-primary").focus();let c=a.onshow||b.option.onshow;c&&c.call(b)},100)}).off("hidden.bs.modal").on("hidden.bs.modal",function(){clearTimeout(b._closeTimer);b._closeTimer=setTimeout(function(){let c=a.onclose||b.option.onclose;c&&c.call(b)},100)});return this};return g}();
Cell.Tooltip=function(){function g(c={}){var n=g.prototype;this.option=c;this.option.closeable=void 0===this.option.closeable?!0:this.option.closeable;this._tooltip=k(this.option.appendTo);f(this._tooltip);this._closebtn=document.createElement("button");$(this._closebtn).appendTo($(this._tooltip)).addClass("close").html("&times;").attr({type:"button","aria-label":"Close"});m(this);n.find=function(a){return $(this._tooltip).find(a)};n.setClassName=function(a){$(this._tooltip).removeClass().addClass("cell-tooltip alert alert-dismissible").addClass(a||
this.option.className||"alert-light");return this};n.setContent=function(a){this.find(".tooltip-content").html(a||this.option.content);return this};n.setContentClass=function(a){this.find(".tooltip-content").removeClass().addClass("tooltip-content").addClass(a||this.option.contentClass||"");return this};n.setIcon=function(a,b){e(this,a,b);return this};n.show=function(c={}){c.closeable=void 0===c.closeable?this.option.closeable:c.closeable;this.setIcon(c.iconClass,c.faicon||l(c.type||0)).setContent(c.content).setContentClass(c.contentClass).setClassName(c.className);
a(this,c.delay||this.option.delay||3E3);c=c.closeable;$(this._tooltip).toggleClass("alert-dismissible",c);c?$(this._closebtn).show():$(this._closebtn).hide();$(this._tooltip).fadeIn();return this};n.hide=()=>{$(this._tooltip).fadeOut();clearTimeout(this.timeout);return this}}var k=function(a="body"){return $(document.createElement("div")).appendTo(a).addClass("cell-tooltip alert alert-dismissible").attr({tabindex:"-1",role:"alert","aria-hidden":!0}).css("display","none")},f=function(a){$(document.createElement("div")).appendTo($(a)).addClass("tooltip-content")},
m=function(a){$(a._closebtn).on("click",function(){a.hide()});return this},l=function(a){switch(a){case 1:case "warning":return"fas fa-exclamation-triangle";case 2:case "success":return"fas fa-check-circle";case 3:case "info":return"fas fa-info-circle";case 4:case "error":return"fas fa-times";default:return""}},e=function(a,e,f){let b=$(a._tooltip);b.find(".tooltip-icon").remove();$(document.createElement("i")).prependTo(b).addClass("tooltip-icon").addClass(e||a.option.iconClass||null).addClass(f||
a.option.faicon||null);return this},a=function(a,e){a.timeout&&clearTimeout(a.timeout);a.timeout=setTimeout(()=>{a.hide()},e);return this};return g}();
Cell.Message=function(){function g(){var k=g.prototype;this._dialog=new Cell.Dialog({appendTo:document.body,className:"cell-message",buttons:{label:"OK",faicon:"fas fa-check",type:"btn-primary",attrs:{autofocus:!0}}});k.setLabel=function(f){$(this._dialog._modalContent).find(".btn-primary").find("span").html(f||this.option&&this.option.label||"OK");return this};k.show=function(f){this.setLabel(f.label);f.content=f.content||"";f.onclose=f.ok;f.backdrop=void 0===f.backdrop?"static":f.backdrop;!0===
f.noButton?this._dialog.find(".btn-primary").hide():this._dialog.find(".btn-primary").show().focus();this._dialog.show(f);return this};k.hide=()=>{this._dialog.hide()}}return g}();
Cell.Confirm=function(){function g(k={}){var f=g.prototype;this._dialog=new Cell.Dialog({appendTo:k.replaceTo?null:k.appendTo||document.body,replaceTo:k.replaceTo,className:"cell-confirm",buttons:[{className:"cancel",attrs:{autofocus:!0}},{className:"ok"}]});f.setButton=function(f,g){let e=this,a=$(this._dialog._modalContent).find(`.${f}`);a.removeAttr("class").addClass("btn").addClass(f).addClass(g.type).find("span").html(g.label||"");a.find(".svg-inline--fa").remove();$(document.createElement("i")).prependTo(a).addClass("fas").addClass(g.faicon);
!0===g.autoFocus?$(a).attr("autofocus",!0):$(a).removeAttr("autofocus");if(g.click)$(a).unbind("click").on("click",function(){setTimeout(g.click.call(e),300)});return this};f.show=function(f){this.setButton("ok",$().extend({label:"OK",faicon:"fa-check",type:"btn-primary"},f.ok));this.setButton("cancel",$().extend({label:"Cancel",faicon:"fa-times",type:"btn-light"},f.cancel));f.content=f.content||"";f.backdrop=void 0===f.backdrop?"static":f.backdrop;this._dialog.show(f);return this}}return g}();
Cell.Tab=function(){function g(a){var c=g.prototype;this.options=a||{};k(this);f(this);$(document.createElement("hr")).appendTo(this._domNode).addClass("cell-tab-menu-underline");e(this);l(this);c.show=function(a){$c.replaceHistory(location.pathname+location.search+`#${a}`);l(this);return this}}var k=a=>{let c;a.options.replaceTo?c=$(a.options.replaceTo):(c=document.createElement("div"),$(c).appendTo(a.options.appendTo||".cell-main-container"));$(c).addClass("cell-tab-menu");a._domNode=c},f=a=>{a._tabSetting=
[];a.options.tabs.forEach(function(c,e){m(a,c);a._tabSetting[c.target]=c})},m=(a,c)=>{let e="#"+(c.target||"");$(document.createElement("a")).appendTo(a._domNode).addClass("cell-tab-menu-item").addClass(c.faicon||"").addClass(c.className||"").html(c.label).attr("href",e).on("click",function(c){c.preventDefault();$c.replaceHistory(location.pathname+location.search+e);l(a)})},l=a=>{$(".cell-tab.show").removeClass("show");var c=location.hash.toString().replace("#","");let e;if(""===c)e=a.options.defaultTab;
else{for(var f in a._tabSetting)if(c===f||$(document.getElementById(f)).find(document.getElementById(c)).length){e=f;break}e=e||c}f=$(a._domNode).find(`[href="#${e}"]`);if(0!==f.length){var b=a._tabSetting[e]||{};$(a._domNode).find(".cell-tab-menu-underline").width($(f).outerWidth()).css("left",$(f).position().left);$(a._domNode).find(".cell-tab-menu-item.selected").removeClass("selected");$(document.getElementById(e)).addClass("show");$(f).addClass("selected");if(c&&c!==e){var h=document.getElementById(e);
let b=$(document.getElementById(c));c=$(h).scrollParent().find(".position-sticky:visible, .sticky-top:visible, .position-fixed:visible").filter(function(b,a){return"auto"!==$(a).css("top")});h=b.offset().top-$(h).offset().top;c.length&&(h-=parseInt(c.css("top"))+c.outerHeight());0<h&&$(window).scrollTop(h)}"true"!==$(f).attr("data-initialized")&&($(f).attr("data-initialized",!0),b.init&&b.init.call(a),!1!==a.options.autoSticky&&$c.stackSticky("top",`#${e}`));b.onshow&&b.onshow.call(this);$(document.getElementById(e)).find("[autofocus]").focus()}};
let e=a=>{$(window).off("hashchange").on("hashchange",function(c){l(a)})};return g}();
Cell.Searchbar=function(){function g(d){var a=g.prototype;this.options=d||{};this.options.valueName=this.options.valueName||"value";this.options.labelName=this.options.labelName||"label";this.options.varName=this.options.varName||"q";this._lastDisplayValue="";this._domNode=k(this);f(this);m(this);c(this);this._xhr=null;a.getValue=function(){return $(this._domNode).find(".cell-searchbar-input").val()};a.getDisplayValue=function(){return $(this._domNode).find(".cell-searchbar-display-input").val()};
a.setValue=function(d){l(this,d);return this};a.search=function(d=!0){b(this,!0,d);return this};a.selectPropose=function(d,a=!0){$(d).addClass("hover");d=$(this._domNode);!0===a?d.find(".cell-searchbar-display-input").trigger($.Event("keyup",{keyCode:13})):d.trigger("focusout");return this};a.addPropose=function(d){let a=this,b=document.createElement("li"),c=$(b);c.appendTo($(this._domNode).find(".cell-searchbar-propose")).attr("data-label",d[a.options.labelName]).attr("data-value",d[a.options.valueName]).attr("data-keyword",
d.keyword||null).data(d).on("click",function(){a.selectPropose(this)});this.options.formatter?this.options.formatter.call(this,b,d):c.html(d[a.options.labelName]);d=c.children();0===d.length?v(a,c):$.each(d,(d,b)=>{v(a,b)});return this};a.resetPropose=function(){$(this._domNode).find(".cell-searchbar-propose").empty();$(this._domNode).find(".cell-searchbar-loader").show();$(this._domNode).find(".cell-searchbar-empty-message").hide();$(this._domNode).find(".cell-searchbar-notfind-message").hide();
return this};a.renderPropose=function(){let d=$(this._domNode),a=$(this._domNode).find(".cell-searchbar-result");d.scrollParent().height()-d.position().top-d.outerHeight()-100<a.height()?a.css({bottom:$(this._domNode).find(".cell-searchbar-form").outerHeight(),top:""}):a.css({bottom:"",top:$(this._domNode).find(".cell-searchbar-form").outerHeight()});return this};a.reset=function(d){this.resetPropose();e(this,null,null,!0);!0===d&&r(this);$(this._domNode).find(".cell-searchbar-display-input").focus();
return this};a.complete=function(){r(this);return this};a.setSearchUrl=function(d){this.options.searchUrl=d;return this};a.setSearchData=function(d){this.options.searchData?$.extend(this.options.searchData,d):this.options.searchData=d;return this};a.setRequired=function(d){this.options.required=d;!0===this.options.required?$(this._domNode).find(".cell-searchbar-display-input").attr("required",!0):$(this._domNode).find(".cell-searchbar-display-input").removeAttr("required");q(this,!0);return this};
a.blur=function(){$(this._domNode).blur();return this};a.focus=function(){$(this._domNode).find(".cell-searchbar-display-input").focus();return this};if(this.options.displayValue||this.options.value)e(this,this.options.displayValue,this.options.value,!1),this._lastDisplayValue=this.options.displayValue}var k=d=>{let a;d.options.replaceTo?a=$(d.options.replaceTo).attr("class",""):(a=$(document.createElement("div")),a.appendTo(d.options.appendTo||".cell-main-container"));a.attr("tabindex","-1").addClass("cell-searchbar");
return a[0]},f=d=>{let a=document.createElement("div");$(a).appendTo(d._domNode).addClass("cell-searchbar-form").attr("tabindex","-1");!1!==d.options.faicon&&$(document.createElement("i")).appendTo(a).addClass("fas "+(d.options.faicon||"fa-search"));var b=document.createElement("input");$(b).appendTo(a).addClass("cell-searchbar-display-input").attr("type","text").attr("placeholder",d.options.placeholder||"Search").attr("autofocus",d.options.autofocus||!1).attr("autocomplete","off").attr("name",d.options.displayName||
null);!0===d.options.required&&$(b).attr("required",d.options.required||null);$(document.createElement("input")).appendTo(a).addClass("cell-searchbar-input").attr("type","hidden").attr("name",d.options.name);d=$(document.createElement("span"));d.appendTo(a).addClass("cell-searchbar-btn-empty").attr("tabindex","-1");$(document.createElement("i")).appendTo(d).addClass("fas fa-times")},m=d=>{if("string"===typeof d.options.searchUrl){var a=document.createElement("div");$(a).appendTo(d._domNode).addClass("cell-searchbar-result").css("top",
$(d._domNode).find(".cell-searchbar-form").outerHeight());$(document.createElement("ul")).appendTo(a).addClass("cell-searchbar-propose");var b=document.createElement("div");$(b).appendTo(a).addClass("cell-searchbar-loader");$(document.createElement("span")).appendTo(b).addClass("fad fa-spinner-third fa-spin m-r-1");$(document.createElement("span")).appendTo(b).html(d.options.loadingMessage||"Loding");$(document.createElement("div")).appendTo(a).addClass("cell-searchbar-empty-message").html(d.options.emptyMessage||
"No any propose");$(document.createElement("div")).appendTo(a).addClass("cell-searchbar-notfind-message").html(d.options.notfindMessage||"Not find relative propose")}},l=(d,a)=>{d.resetPropose();let b=a[d.options.labelName],c=a[d.options.valueName];d.addPropose(a);e(d,b,c,!0);return this},e=(d,b,c,e=!1,h)=>{$(d._domNode).find(".cell-searchbar-display-input").val(b||c||"");b=$(d._domNode).find(".cell-searchbar-input").val(c);!0===e&&b.trigger("change",h);a(d);return this},a=d=>{let a=$(d._domNode).find(".cell-searchbar-btn-empty");
0<d.getDisplayValue().length?a.css("display","inline-flex"):a.css("display","none");return t(d)},c=d=>{let c=$(d._domNode);c.on("focusout",function(a){c.removeClass("focused");a.relatedTarget!==this&&a.target!==c.find(".cell-searchbar-form")[0]&&(y(d,!0)||x(d,!0)||!d.options.matchPropose&&e(d,d.getDisplayValue(),d.getDisplayValue(),!0),d.options.onblur&&d.options.onblur.call(d,d.getDisplayValue(),d.getValue()),!0===d.options.completeClean&&e(d,null,null))}).on("focusin",function(){c.addClass("focused");
!0===d.options.focusClean&&e(d,null,null)}).find(".cell-searchbar-display-input").off("focus").on("focus",function(a){a.stopPropagation();a.preventDefault();c.removeClass("using");$(this).select();d.options.onfocus&&!1===d.options.onfocus.call(d,a,d.getDisplayValue(),d.getValue())||!0===d.options.autoSearch&&b(d,!0)}).on("input",function(){c.find(".cell-searchbar-input").val("");a(d);b(d)}).on("keydown",function(a){38===a.keyCode&&u(d,-1);40===a.keyCode&&u(d,1)}).on("keyup",function(a){if(13===a.keyCode)return d.blur();
if(27===a.keyCode)return d.reset()}).on("valid",function(){q(d,!0)}).on("invalid",function(){q(d,!1)});c.find(".cell-searchbar-input").on("change",function(a,b){r(d,b);d.options.onchange&&d.options.onchange.call(d,d.getDisplayValue(),d.getValue(),b)});c.find(".cell-searchbar-form").on("focus",function(){$(d._domNode).find(".cell-searchbar-display-input").focus().focus()});c.find(".cell-searchbar-btn-empty").on("focus, focusin",function(a){a.stopPropagation()}).on("click",function(){d.reset(!0)})},
n=a=>{a.options.pattern&&($(a.options.pattern).each(function(d,b){d=b+":";var c=new RegExp(d+"[\\S]+","i");(c=a.getValue().match(c))?(a.options.data[a.options.varName]=a.options.data[a.options.varName].replace(" "+c,"").trim(),a.options.data[b]=c.toString().replace(d,"").trim()):a.options.data[b]=void 0}),a.options.data[a.options.varName]=a.options.data[a.options.varName].trim().replace(" ","|"))},p=a=>{a.options.data=a.options.data||{};a.options.data[a.options.varName]=a.getDisplayValue();a.options.data[a.options.valueName]=
a.getValue();n(a)},b=(a,b=!1,c=!1)=>{!a.options.searchUrl||!0!==b&&a._lastDisplayValue===a.getDisplayValue()||(a._lastDisplayValue=a.getDisplayValue(),p(a),a._xhr&&a._xhr.abort(),a.options.oninput&&!1===a.options.oninput.call(a,a.options.data)||(b=$.extend(a.options.searchData,a.options.data),""===b[a.options.varName]&&delete b[a.options.varName],""===b[a.options.valueName]&&delete b[a.options.valueName],a.resetPropose(),a._xhr=$c.ajax.get({url:a.options.searchUrl,data:b,success:function(b){$(b).each(function(b,
d){a.addPropose(d)});w(a);a.renderPropose();!0===c&&h(a)},error:function(a){}})))},h=a=>{let b=$(a._domNode).find(".cell-searchbar-propose li:first-child");1===b.length&&a.selectPropose(b,!1)},w=a=>{let b=$(a._domNode).find(".cell-searchbar-notfind-message"),d=$(a._domNode).find(".cell-searchbar-empty-message");$(a._domNode).find(".cell-searchbar-loader").hide();0!==$(a._domNode).find(".cell-searchbar-propose li").length?(d.hide(),b.hide()):0===a.getDisplayValue().length?(d.show(),b.hide()):(d.hide(),
b.show())},t=a=>{if(!a.options.searchUrl||!1===a.options.matchPropose)return!0;let b=a.getDisplayValue().replace('"','\\"');if(0<a._domNode.querySelectorAll(`li[${"data-label"}="${b}" i], li[${"data-keyword"}="${b}" i]`).length&&0<b.length||!0!==a.options.required&&0===b.length)return q(a,!0),!0;q(a,!1);return!1},x=(a,b=!1)=>{if(!a.options.searchUrl||!1===a.options.matchPropose||0===a.getDisplayValue().length)return!1;var d=a.getDisplayValue().replace('"','\\"'),c=a._domNode.querySelectorAll(`li[${"data-label"}*="${d}" i], li[${"data-keyword"}*="${d}" i]`);
d=a._domNode.querySelectorAll(`li[${"data-label"}="${d}" i], li[${"data-keyword"}="${d}" i]`);if(1!==d.length&&1!==c.length)return!1;c=$(1===d.length?d:c);e(a,c.attr("data-label"),c.attr("data-value"),b);return!0},y=(a,b=!1)=>{let d=$(a._domNode).find(".cell-searchbar-propose").find("li.hover");if(0===d.length)return!1;e(a,d.attr("data-label"),d.attr("data-value"),b,d.data());return!0},u=(a,b)=>{a=$(a._domNode).find(".cell-searchbar-propose");let d=a.find("li.hover").removeClass("hover"),c=0<b?a.find("li:first-child"):
a.find("li:last-child");b=0===d.length?c:0<b?d.next():d.prev();0===b.length&&(b=c);b.addClass("hover");a=a.scrollParent();0>b.position().top&&a.scrollTop(a.scrollTop()+b.position().top);b.position().top+b.height()+10>a.height()&&a.scrollTop(a.scrollTop()+b.position().top+b.height()+10-a.height())},v=(a,b)=>{b=$(b);if(a=a.getDisplayValue())a=new RegExp(`(${$c.pregQuote(a)})`,"gi"),b.html(b.html().replace(a,'<span class="highlight">$1</span>'))},r=(a,b)=>{t(a)&&a.options.oncomplete&&(a.options.searchUrl||
a._lastDisplayValue!==a.getDisplayValue())&&(a._lastDisplayValue=a.getDisplayValue(),p(a),a.options.oncomplete.call(a,a.options.data,b),!0===a.options.completeClean&&e(a,null,null),!0===a.options.changeUrl&&(a=$c.setUrlParam(window.location.pathname+window.location.search,a.options.varName,encodeURIComponent(a.options.data[a.options.varName])||null),$c.pushHistory(a+window.location.hash)))},q=(a,b)=>{let c=$(a._domNode).find(".cell-searchbar-form"),d=$(a._domNode).find(".cell-searchbar-display-input")[0];
!0===b?(c.removeClass("invalid").addClass("valid"),d.setCustomValidity("")):(c.removeClass("valid").addClass("invalid"),d.setCustomValidity("error"));return a};return g}();
Cell.Filter=function(){function g(a){var c=g.prototype;this.options=a||{};this.options.name=this.options.name||"f";this.options.default=this.options.default||null;this._filter=k(this.options.appendTo,this.options.replaceTo);this._label=$(this._filter).find(".cell-filter-label");this._value=$(this._filter).find(".cell-filter-value");this.value=null;c.getItemLabel=function(a){return"null"===a||null===a?$(this._filter).find(`.cell-filter-item.${this.options.name.toString().replace(/_/g,"-")}`).html():
$(this._filter).find(`[value="${a}"]`).html()};c.selectItem=function(a){var c=$(a).attr("value");this.value!==c&&(this.value=c,$(this._value).html($(a).html()),!0===this.options.changeUrl&&(c=$c.setUrlParam(window.location.pathname+window.location.search,this.options.name,c||null),$c.pushHistory(c+window.location.hash)),this.options.onchange.call(this,a,this.value));$(this._filter).blur();return this};f(this)}var k=(a=".cell-main-container",c)=>{c?c=$(c).attr("class",""):(c=document.createElement("div"),
$(c).appendTo(a));$(c).attr("tabindex","1").addClass("cell-filter");a=document.createElement("div");$(a).appendTo(c).addClass("cell-filter-btn");$(document.createElement("span")).appendTo(a).addClass("cell-filter-label");$(document.createElement("span")).appendTo(a).addClass("cell-filter-value");return c},f=a=>{if(!a.options.url&&a.options.option)return m(a),a;$c.ajax.get({url:a.options.url,success:function(c){a.options.option=c;m(a)}});return a},m=a=>{l(a);$(a._label).html(a.options.label);$(a._value).html(a.getItemLabel(a.options.default));
if(!0===a.options.changeUrl&&a.options.default){let c=$c.setUrlParam(window.location.pathname+window.location.search,a.options.name,a.options.default)+window.location.hash;window.history.replaceState({url:c},null,c)}return a},l=a=>{let c=document.createElement("div");$(c).appendTo(a._filter).addClass("cell-filter-option");$.each(a.options.option,function(e,f){var b=a.options.name;b=b.toString().replace(/_/g,"-");$(document.createElement("div")).appendTo(c).addClass("cell-filter-item").addClass("null"!==
e?`${b}-${e}`:b).html(String(f).toString().trim()).attr("value","null"!==e?e:"")});e(a);return a},e=a=>{$(a._filter).find(".cell-filter-item").on("click",function(){a.selectItem(this)});return a};return g}();
Cell.Uploader=function(){function g(a){var b=g.prototype;this.options=a||{};this._dragCounter=0;this.options.name=this.options.name||"files";k(this);e(this);b.reload=function(){this.options.multiple?this.list.reload():this.list.reset()}}var k=b=>{b.options.replaceTo?b._domNode=$(b.options.replaceTo):(b._domNode=document.createElement("div"),$(b._domNode).appendTo(b.options.appendTo||document.querySelector(".cell-main-container")||document.body));$(b._domNode).addClass("cell-uploader").addClass(b.options.className||
"");b.options.dragPanel=b.options.dragPanel||b._domNode;b._idx=$(".cell-uploader").length;Array.isArray(b.options.accept)&&(b.options.accept=`.${b.options.accept.join(",.")}`);var e=document.createElement("input");$(e).appendTo(b._domNode).addClass("cell-uploader-input").attr("id","cell-uploader-input"+b._idx).attr("type","file").attr("accept",b.options.accept||null).on("change",function(a){b._droppedFiles=a.target.files;c(b)});!0===b.options.multiple&&$(e).attr("multiple",!0);a(b);e=document.createElement("label");
$(e).appendTo(b._domNode).attr("for","cell-uploader-input"+b._idx).addClass("cell-uploader-label");$(document.createElement("strong")).appendTo(e).addClass("cell-uploader-strong").html(b.options.label||"Choose a file");$(document.createElement("span")).appendTo(e).addClass("cell-uploader-span").html(b.options.dragLabel||"or drop file to here.");$(document.createElement("span")).appendTo(e).addClass("cell-uploader-filetype").addClass("brackets");f(b);m(b);l(b)},f=a=>{$(a.options.dragPanel).addClass("cell-uploader-drag-panel");
$(document.createElement("div")).appendTo(a.options.dragPanel).addClass("cell-uploader-dragover-message").html(a.options.dragMessage||"Drop files here to upload.")},m=a=>{if(!0!==a.options.disableRemove){var b=document.createElement("div");$(b).appendTo(a._domNode).addClass("cell-grid-toolbar");var c=document.createElement("div");$(c).appendTo(b).addClass("float-right");b=document.createElement("span");$(b).appendTo(c).addClass("cell-btn-circle btn-remove-file d-none").attr("data-toggle","tooltip").attr("title",
"Delete file").on("click",function(){p(a)}).tooltip();$(document.createElement("i")).appendTo(b).addClass("fa fa-trash-alt")}},l=a=>{a.list=new Cell.Grid({appendTo:a._domNode,url:a.options.url,query:a.options.query,headerSticky:!1,identify:"displayId",selector:!a.options.disableRemove,fields:[{name:"displayId",hidden:!0},{name:"id",hidden:!0},{name:"size",hidden:!0},{name:"name",label:"File",formatter:function(b,c,e){if(!0!==a.options.displaySize)return e;let f=document.createElement("div");$(f).appendTo(c);
$(document.createElement("span")).appendTo(f).html(e);$(document.createElement("span")).appendTo(f).addClass("size").html($c.file.formatBytes(this.getItemData(b,"size")))}},{name:"message",label:"Status",formatter:function(b,c,e){e&&(b=this.getItemData(b,"id"),$(c).html(e.message||n(e.code)),$(c).removeClass("uploading"),-1<Number(e.code)&&$(c).addClass("status-"+e.code),0===e.code&&b&&$(document.createElement("input")).appendTo(c).attr("type","hidden").attr("name",a.options.name+"[]").val(b))}}],
emptyMessage:a.options.emptyMessage||"No files.",onselected:function(b){$(a._domNode).find(".cell-grid-toolbar .cell-btn-circle").toggleClass("d-none",!b.length)},onload:function(){!a.options.multiple&&1<this.getItemCount()&&this.removeItems(this.getItemId(this.getFirstItem()))}})},e=a=>{$(a.options.dragPanel).on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault();a.stopPropagation()}).on("dragenter",function(){$(this).addClass("cell-uploader-dragover");a._dragCounter++}).on("dragleave",
function(){a._dragCounter--;0===a._dragCounter&&$(this).removeClass("cell-uploader-dragover")}).on("drop",function(b){!0===a.options.clearOnDrag&&a.reload();a._dragCounter=0;$(this).removeClass("cell-uploader-dragover");a._droppedFiles=b.originalEvent.dataTransfer.files;c(a)})},a=a=>{$c.ajax.get({url:a.options.fileTypeUrl||$c.router("//file_manager/extensions"),success:function(b){$("#cell-uploader-input"+a._idx).attr("accept",a.options.accept?`${a.options.accept},${b.types}`:b.types);a.options.fileType=
b.exts;Array.isArray(a.options.fileType)&&$(a._domNode).find(".cell-uploader-filetype").html(a.options.fileType.join(", "))}})},c=a=>{let b=new FormData(a.options.data);if(a._droppedFiles){!0!==a.options.multiple&&(a.reload(),a._droppedFiles=[a._droppedFiles[0]]);var c=[];$.each(a._droppedFiles,(e,f)=>{e=a.list.addItem({id:null,name:f.name,size:f.size},!0);c.push(e);b.append("display_ids[]",e);b.append("files[]",f)});$c.ajax.post({url:a.options.uploadUrl,data:b,cache:!1,contentType:!1,processData:!1,
xhr:function(){$(a._domNode).find(".cell-uploader-input").val(null);let b=$.ajaxSettings.xhr();b.upload&&b.upload.addEventListener("progress",function(b){b.lengthComputable&&(b=(100*b.loaded/b.total).toFixed(2),a.list.setItemColVal(c,"message",{code:-1,message:"\u4e0a\u50b3\u4e2d ("+b+"%)"}))},!1);return b},success:function(b){$.each(b,function(b,c){a.list.setItemColVal(b,"id",c.id||null);a.list.setItemColVal(b,"message",{code:c.err_code,message:c.message})});0===b.length&&$.each(c,function(b,c){a.list.setItemColVal(c,
"message",{code:99,message:"\u4e0d\u660e\u7684\u932f\u8aa4\uff0c\u8acb\u6aa2\u67e5\u4f3a\u670d\u5668\u8a2d\u5b9a"})});a.options.onuploaded&&a.options.onuploaded.call(a,b)}})}},n=a=>{switch(a){case 0:return"\u4e0a\u50b3\u5b8c\u6210";case 1:return"\u4e0a\u50b3\u5931\u6557\uff1a\u6a94\u6848\u5927\u5c0f\u8d85\u51fa\u9650\u5236 "+a;case 2:return"\u4e0a\u50b3\u5931\u6557\uff1a\u6a94\u6848\u5927\u5c0f\u8d85\u51fa\u9650\u5236 "+a;case 8:return"\u4e0a\u50b3\u5931\u6557\uff1a\u4e0d\u5141\u8a31\u7684\u6a94\u6848\u985e\u578b";
case 9:return"\u4e0a\u50b3\u5931\u6557\uff1a"+a;default:return"\u4e0a\u50b3\u5931\u6557\uff1a"+a}},p=a=>{let b=a.list.getSelectionVal("displayId"),c=a.list.getSelectionVal("id");if(0===c.length)return a.list.removeItems(b),this;$c.ajax.delete({url:a.options.removeUrl,data:{ids:c},success:function(){a.list.removeItems(b)}});return this};return g}();
Cell.SingleUploader=function(){function g(e){var a=g.prototype;this.options=e||{};this.options.name=this.options.name||"files";k(this);a.setInfo=function(a){$(this._domNode).find(".cell-single-uploader-info").html(a)}}var k=e=>{e.options.replaceTo?e._domNode=$(e.options.replaceTo):(e._domNode=document.createElement("div"),$(e._domNode).appendTo(e.options.appendTo||document.querySelector(".cell-main-container")||document.body));var a=document.createElement("input");Array.isArray(e.options.accept)&&
(e.options.accept=`.${e.options.accept.join(",.")}`);$(a).appendTo(e._domNode).addClass("cell-single-uploader-input").addClass("form-control-file").attr("type","file").attr("accept",e.options.accept||null).on("change",function(a){e._droppedFiles=a.target.files;m(e)});f(e);a=$(document.createElement("div")).appendTo(e._domNode);$(document.createElement("span")).appendTo(a).addClass("cell-single-uploader-info text-info");$(document.createElement("small")).appendTo(a).addClass("cell-single-uploader-label").html(e.options.label);
$(document.createElement("small")).appendTo(a).addClass("text-muted cell-uploader-filetype").addClass("brackets")},f=e=>{$c.ajax.get({url:e.options.fileTypeUrl||$c.router("//file_manager/extensions"),success:function(a){$(e._domNode).find("input").attr("accept",e.options.accept?`${e.options.accept},${a.types}`:a.types);e.options.fileType=a.exts;Array.isArray(e.options.fileType)&&$(e._domNode).find(".cell-uploader-filetype").html(e.options.fileType.join(", "))}})},m=e=>{let a=new FormData(e.options.data);
e._droppedFiles&&(a.append("file",e._droppedFiles[0]),$c.ajax.post({url:e.options.uploadUrl,data:a,cache:!1,contentType:!1,processData:!1,xhr:function(){$(e._domNode).find(".cell-single-uploader-input").val(null);let a=$.ajaxSettings.xhr();a.upload&&a.upload.addEventListener("progress",function(a){a.lengthComputable&&(a=(100*a.loaded/a.total).toFixed(2),$(e._domNode).find(".cell-single-uploader-info").html("Uploading..."+a+"%"))},!1);return a},success:function(a){a||e.setInfo("\u4e0d\u660e\u7684\u932f\u8aa4\uff0c\u8acb\u6aa2\u67e5\u4f3a\u670d\u5668\u8a2d\u5b9a");
0===a.code?(e.setInfo("Success!"),e.options.onuploaded&&e.options.onuploaded.call(e,a)):e.setInfo(l(a.code))}}))},l=e=>{switch(e){case 0:return"\u4e0a\u50b3\u5b8c\u6210";case 1:return"\u4e0a\u50b3\u5931\u6557\uff1a\u6a94\u6848\u5927\u5c0f\u8d85\u51fa\u9650\u5236 "+e;case 2:return"\u4e0a\u50b3\u5931\u6557\uff1a\u6a94\u6848\u5927\u5c0f\u8d85\u51fa\u9650\u5236 "+e;case 8:return"\u4e0a\u50b3\u5931\u6557\uff1a\u4e0d\u5141\u8a31\u7684\u6a94\u6848\u985e\u578b";case 9:return"\u4e0a\u50b3\u5931\u6557\uff1a"+
e;default:return"\u4e0a\u50b3\u5931\u6557\uff1a"+e}};return g}();$().ready(()=>{$c.confirm=new Cell.Confirm;$c.message=new Cell.Message;$c.tooltip=new Cell.Tooltip});